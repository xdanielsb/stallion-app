<div class="camera-app">
  <header class="app-header">
    <h1>{{ title() }}</h1>
    <p>Camera feed for image capture and inference</p>
  </header>
  
  <main class="camera-container">
    <div class="video-wrapper">
      <!-- Video element always rendered but visibility controlled -->
      <video 
        #videoElement 
        autoplay 
        playsinline 
        muted
        [class.visible]="isCameraActive()"
        class="camera-feed">
      </video>
      
      <!-- Overlay elements that show/hide based on state -->
      @if (isCapturing()) {
        <div class="loading-spinner">
          <div class="spinner"></div>
          <p>Initializing camera...</p>
        </div>
      } @else if (errorMessage()) {
        <div class="error-message">
          <div class="error-icon">‚ö†Ô∏è</div>
          <h2>Camera Error</h2>
          <p>{{ errorMessage() }}</p>
          <button class="retry-button" (click)="initializeCamera()">Retry</button>
        </div>
      } @else if (!isCameraActive()) {
        <div class="camera-off">
          <div class="camera-icon">üì∑</div>
          <p>Camera is off</p>
          <button class="start-button" (click)="initializeCamera()">Start Camera</button>
        </div>
      }
      
      <!-- Controls only show when camera is active -->
      @if (isCameraActive()) {
        <div class="camera-controls">
          <button class="capture-button" (click)="captureImage()">
            <span class="capture-icon"></span>
            Capture
          </button>
          <button class="stop-button" (click)="stopCamera()">
            Stop Camera
          </button>
        </div>
      }
      
      <!-- Hidden canvas for image capture -->
      <canvas #canvasElement style="display: none;"></canvas>
    </div>
    
    <!-- Image Processing Results -->
    @if (processingStatus()) {
      <div class="processing-results" 
           [class.success]="processingStatus()?.success" 
           [class.error]="!processingStatus()?.success">
        <h3>Image Processing</h3>
        <p class="status-message">{{ processingStatus()?.message }}</p>
      </div>
    }
    
    @if (imageInfo() || colorInfo()) {
      <div class="image-info">
        <h3>üìä Image Analysis Results</h3>
        
        @if (imageInfo()) {
          <div class="info-section">
            <h4>üñºÔ∏è Image Information</h4>
            <div class="info-grid">
              <div class="info-item">
                <span class="label">Dimensions:</span>
                <span class="value">{{ imageInfo()!.width }} √ó {{ imageInfo()!.height }}</span>
              </div>
              <div class="info-item">
                <span class="label">Format:</span>
                <span class="value">{{ imageInfo()!.format }}</span>
              </div>
              <div class="info-item">
                <span class="label">Size:</span>
                <span class="value">{{ formatFileSize(imageInfo()!.size_bytes) }} KB</span>
              </div>
              <div class="info-item">
                <span class="label">Aspect Ratio:</span>
                <span class="value">{{ imageInfo()!.aspect_ratio.toFixed(2) }}</span>
              </div>
            </div>
          </div>
        }
        
        @if (colorInfo()) {
          <div class="info-section">
            <h4>üé® Color Information</h4>
            <div class="info-grid">
              <div class="info-item">
                <span class="label">Dominant Color:</span>
                <div class="color-display">
                  <div class="color-box" 
                       [style.background-color]="colorInfo()!.dominant_color"></div>
                  <span class="value">{{ colorInfo()!.dominant_color }}</span>
                </div>
              </div>
              <div class="info-item">
                <span class="label">Grayscale:</span>
                <span class="value" [class.grayscale]="colorInfo()!.is_grayscale">
                  {{ colorInfo()!.is_grayscale ? 'Yes' : 'No' }}
                </span>
              </div>
              <div class="info-item">
                <span class="label">Transparency:</span>
                <span class="value">
                  {{ colorInfo()!.has_transparency ? 'Yes' : 'No' }}
                </span>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </main>
</div>